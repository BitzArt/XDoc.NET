<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
    <Target Name="CopyXmlDocumentationFiles" AfterTargets="Build">
        <ItemGroup>
            <!-- Include XML docs from referenced assemblies -->
            <XmlDocs Include="@(ReferencePath->'%(RootDir)%(Directory)%(Filename).xml')"
                     Condition="Exists('%(RootDir)%(Directory)%(Filename).xml')"/>
            
            <!-- Include XML docs from referenced packages -->
            <XmlDocs Include="$(NuGetPackageRoot)\**\*.xml"
                     Condition="'$(NuGetPackageRoot)' != '' AND Exists('$(NuGetPackageRoot)')"/>
            
            <!-- Include XML docs from project references -->
            <XmlDocs Include="@(ProjectReference->'%(RootDir)%(Directory)%(FileName).xml')"
                    Condition="Exists('%(RootDir)%(Directory)%(FileName).xml')"/>
        </ItemGroup>
        
        <Copy SourceFiles="@(XmlDocs)" DestinationFolder="$(OutputPath)" SkipUnchangedFiles="true"/>
        <Message Text="Copied XML documentation files to output directory: @(XmlDocs->Count()) files" Importance="high" />
        <Message Text="Files copied: @(XmlDocs->'%(Filename)%(Extension)')" Importance="normal" />
    </Target>
</Project>